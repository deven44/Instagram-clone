<% include ./partials/header.ejs %>
  <div class="w-full min-h-screen bg-zinc-900 text-white py-5">
    <div class="w-full px-4 flex items-center justify-between">
      <img class="w-1/4" src="/images/logo.png" alt="">
      <div class="icons -mt-2 flex gap-5 items-center">
        <i class="text-[1.4rem] ri-heart-3-line"></i>
        <i class="text-[1.4rem] ri-messenger-line"></i>
      </div>
    </div>
    <div class="story px-3 flex gap-3 overflow-auto mt-5">
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?q=80&w=2550&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1570158268183-d296b2892211?q=80&w=3456&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?q=80&w=2550&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1570158268183-d296b2892211?q=80&w=3456&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?q=80&w=2550&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
      <div class="circle flex-shrink-0">
        <div
          class="gradient w-[18vw] h-[18vw] bg-sky-100 rounded-full bg-gradient-to-r from-purple-700 to-orange-500 flex items-center justify-center">
          <div class="inner w-[92%] h-[92%] rounded-full overflow-hidden">
            <img class="w-full h-full object-cover"
              src="https://images.unsplash.com/photo-1570158268183-d296b2892211?q=80&w=3456&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="">
          </div>
        </div>
      </div>
    </div>
    <div class="posts parent mb-20">
      <% posts.reverse().forEach(function(post){ %>
        <div class="post mt-10 w-full min-h-[50vh]">
          <div class="title px-4 flex items-center gap-2">
            <div class="w-[9vw] h-[9vw] bg-sky-100 rounded-full overflow-hidden">
              <img src="/images/uploads/<%= post.user.picture %>" alt="">
            </div>
            <h4 class="text-sm">
              <%= post.user.username %>
            </h4>
            <h6 class="text-xs opacity-30"> </h6>
          </div>
          <div class="relative w-full h-96 mt-4 bg-sky-100 overflow-hidden">
            <img data-postid="<%= post._id %>" class="postimg w-full h-full object-cover " src="/images/uploads/<%= post.picture %>" alt="">
          </div>
          <div class="options w-full px-4 flex justify-between items-center text-[1.4rem]">
            <div class="flex gap-3 mt-2">
              <%if(post.like.indexOf(user._id) ==-1){ %>
                <i class="heart ri-heart-3-line"></i>
                <% } else{%>
                <i style="color: red;" class="heart ri-heart-3-fill red"></i>
                <% } %>
            <a href="/comment/<%=post.id%>"> <i class=" ri-chat-3-line"></i></a>
              <i class="ri-share-circle-line"></i>
            </div>
            <% if(user.saved.indexOf(post.id) === -1){ %>
              <i data-postid="<%= post.id %>" class="save ri-bookmark-line"></i>
           <% } else{ %>
           <i data-postid="<%= post.id %>" class="save ri-bookmark-fill"></i>
            <% } %>
          </div>
          <h3 class="likevalue px-4 mt-2 text-sm leading-none tracking-tight">
            <%= post.like.length %> likes
          </h3>
          <h2 class="text-white font-light text-sm mt-2">
            <span class="font-semibold pl-4 pr-2">
              <%= post.user.username %>
            </span>
            <%= post.caption %>
          </h2>
        </div>
        <% }) %>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js" integrity="sha512-NQfB/bDaB8kaSXF8E77JjhHG5PM6XVRxvHzkZiwl3ddWCEPBa23T76MuWSwAJdMGJnmQqM0VeY9kFszsrBEFrQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // function formatRelativeTime(date) {
    //   const now = new Date();
    //   const diff = now - date;

    //   // Convert milliseconds to seconds
    //   const seconds = Math.floor(diff / 1000);

    //   if (seconds < 60) {
    //     return `${seconds}s`;
    //   }

    //   const minutes = Math.floor(seconds / 60);

    //   if (minutes < 60) {
    //     return `${minutes}m`;
    //   }

    //   const hours = Math.floor(minutes / 60);

    //   if (hours < 24) {
    //     return `${hours}h`;
    //   }

    //   const days = Math.floor(hours / 24);

    //   if (days < 7) {
    //     return `${days}d`;
    //   }

    //   const weeks = Math.floor(days / 7);

    //   return `${weeks}w`;
    // }

    
  
    document.querySelector(".parent")
    .addEventListener("click", function(dets){

      if(dets.target.classList.contains('heart')){
        var heart = dets.target

      heart.parentNode.parentNode.parentNode.querySelector('.postimg').click();
      }


      if(dets.target.classList.contains("postimg")){
        var heartwithborder = dets.target.parentNode.parentNode.querySelector(".heart");
        if(heartwithborder.classList.contains("ri-heart-3-line")){
          heartwithborder.classList.remove("ri-heart-3-line")
          heartwithborder.classList.add("ri-heart-3-fill")
          heartwithborder.style.color = "red";
        }else{
          heartwithborder.classList.remove("ri-heart-3-fill")
          heartwithborder.classList.add("ri-heart-3-line")
          heartwithborder.style.color = "white";
        }

        fetch(`/like/${dets.target.dataset.postid}`)
        .then(raw => raw.json())
        .then(response => {
          // document.querySelector(".likevalue").textContent= response.like.length + "likes"
          dets.target.parentNode.parentNode.querySelector(".likevalue").textContent= response.like.length + "likes"
        })
      }else if(dets.target.classList.contains("save")){
        fetch(`/save/${dets.target.dataset.postid}`)
        // let savebtn = document.querySelector(".save")
        let savebtn = dets.target
        if(savebtn.classList.contains("ri-bookmark-line")){
            savebtn.classList.remove("ri-bookmark-line")
            savebtn.classList.add("ri-bookmark-fill","white")
        }else{
          
          savebtn.classList.remove("ri-bookmark-fill")
            savebtn.classList.add("ri-bookmark-line")

        }
      
 
      }
      
      if(dets.target.classList.contains('postimg')){
         
        var i = document.createElement('i')
        i.classList.add('ri-heart-3-fill','scale-[2]','absolute','translate-y-[-50%]','translate-x-[-50%]','left-[50%]','top-[60%]')
        dets.target.parentNode.appendChild(i)
        console.log( dets.target.parentNode);
        gsap.from(i,{
          scale:.5,
          y:-50,
          ease:Power4,
          duration:.3
        })
        gsap.to(i,{
          opacity:.8,
          y:-50,
          scale:5,
          delay:.2,
          ease:Power4,
          duration:.5,
          color:'red',
          onComplete:function(){
            i.remove()
          }
        })
      }

      


    })
  </script>
  <% include ./partials/footer.ejs %>